<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamification System - GreenGo Documentation</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">ğŸŒ¿</span>
                <a href="../index.html" class="logo-text" style="text-decoration: none; color: #D4AF37;">GreenGo</a>
            </div>
        </div>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search...">
        </div>
        <ul class="nav-menu" id="navMenu">
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-home"></i><span>Overview</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="01-introduction.html">1. Introduction</a></li>
                    <li><a href="02-tech-stack.html">2. Tech Stack</a></li>
                </ul>
            </li>
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-sitemap"></i><span>Architecture</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="09-clean-architecture.html">9. Clean Architecture</a></li>
                    <li><a href="14-data-flow.html">14. Data Flow</a></li>
                </ul>
            </li>
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-palette"></i><span>Design System</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="21-brand-guidelines.html">21. Brand</a></li>
                    <li><a href="22-color-palette.html">22. Colors</a></li>
                    <li><a href="25-components.html">25. Components</a></li>
                </ul>
            </li>
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-puzzle-piece"></i><span>Core Features</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="31-auth-flow.html">31. Auth Flow</a></li>
                    <li><a href="32-social-auth.html">32. Social Auth</a></li>
                    <li><a href="33-biometric-auth.html">33. Biometric</a></li>
                    <li><a href="34-onboarding.html">34. Onboarding</a></li>
                    <li><a href="35-photo-upload.html">35. Photos</a></li>
                    <li><a href="36-profile-editing.html">36. Profile</a></li>
                    <li><a href="37-matching-algorithm.html">37. Matching</a></li>
                    <li><a href="38-discovery.html">38. Discovery</a></li>
                    <li><a href="39-like-actions.html">39. Actions</a></li>
                    <li><a href="40-match-system.html">40. Matches</a></li>
                    <li><a href="41-chat.html">41. Chat</a></li>
                    <li><a href="42-message-features.html">42. Messages</a></li>
                    <li><a href="43-push-notifications.html">43. Push</a></li>
                    <li><a href="44-in-app-notifications.html">44. Notifications</a></li>
                    <li><a href="45-subscriptions.html">45. Subscriptions</a></li>
                    <li><a href="46-in-app-purchases.html">46. Purchases</a></li>
                    <li><a href="47-coins.html">47. Coins</a></li>
                    <li><a href="48-gamification.html">48. Gamification</a></li>
                    <li><a href="49-challenges.html">49. Challenges</a></li>
                    <li><a href="50-leaderboards.html">50. Leaderboards</a></li>
                </ul>
            </li>
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-server"></i><span>Backend</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="51-firebase-overview.html">51. Firebase</a></li>
                    <li><a href="55-cloud-functions.html">55. Functions</a></li>
                </ul>
            </li>
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-database"></i><span>Database</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="61-firestore-schema.html">61. Schema</a></li>
                </ul>
            </li>
            <li class="nav-section">
                <div class="nav-section-title"><i class="fas fa-shield-alt"></i><span>Security</span><i class="fas fa-chevron-down arrow"></i></div>
                <ul class="nav-submenu">
                    <li><a href="69-security-architecture.html">69. Security</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        <header class="top-header">
            <button class="mobile-menu-toggle" id="mobileMenuToggle"><i class="fas fa-bars"></i></button>
            <div class="header-title"><h1>Gamification System</h1></div>
        </header>

        <div class="content-wrapper">
            <div class="page-header">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a> / <a href="#">Core Features</a> / Gamification System
                </div>
            </div>

            <div class="page-content">
                
            <h2>Gamification Architecture</h2>
            <p>Complete XP, leveling, achievements, and rewards system to increase user engagement and retention.</p>

            <h2>Gamification Components</h2>
            <pre><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GAMIFICATION SYSTEM ARCHITECTURE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              XP & LEVELING                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Level 1 â”€â”€â–¶ Level 2 â”€â”€â–¶ Level 3 â”€â”€â–¶ ... â”€â”€â–¶ Level 50                       â”‚   â”‚
â”‚  â”‚   0 XP      100 XP      250 XP            50,000 XP                         â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚  XP Sources:                                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Daily login: 10 XP           â€¢ Complete profile: 100 XP                  â”‚   â”‚
â”‚  â”‚  â€¢ Send message: 5 XP           â€¢ Get match: 25 XP                          â”‚   â”‚
â”‚  â”‚  â€¢ Like: 2 XP                   â€¢ Super Like: 5 XP                          â”‚   â”‚
â”‚  â”‚  â€¢ Complete challenge: 50 XP    â€¢ Refer friend: 200 XP                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚                         â”‚
              â–¼                         â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ACHIEVEMENTS   â”‚       â”‚   CHALLENGES    â”‚       â”‚    STREAKS      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ First Match   â”‚       â”‚ â€¢ Daily tasks   â”‚       â”‚ â€¢ Login streak  â”‚
    â”‚ â€¢ Chat Master   â”‚       â”‚ â€¢ Weekly goals  â”‚       â”‚ â€¢ Chat streak   â”‚
    â”‚ â€¢ Social Star   â”‚       â”‚ â€¢ Monthly bonus â”‚       â”‚ â€¢ Swipe streak  â”‚
    â”‚ â€¢ Profile Pro   â”‚       â”‚                 â”‚       â”‚                 â”‚
    â”‚ â€¢ Verified User â”‚       â”‚ Rewards:        â”‚       â”‚ Multipliers:    â”‚
    â”‚                 â”‚       â”‚ Coins, XP,      â”‚       â”‚ 7 days: 1.5x    â”‚
    â”‚ Rewards:        â”‚       â”‚ Boosts, Badge   â”‚       â”‚ 30 days: 2x     â”‚
    â”‚ Badges, Coins   â”‚       â”‚                 â”‚       â”‚ 100 days: 3x    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </code></pre>

            <h2>XP & Level System</h2>
            <pre><code class="language-dart">
// lib/features/gamification/domain/entities/level_system.dart

class LevelSystem {
  static const List<int> levelThresholds = [
    0,      // Level 1
    100,    // Level 2
    250,    // Level 3
    500,    // Level 4
    1000,   // Level 5
    1750,   // Level 6
    2750,   // Level 7
    4000,   // Level 8
    5500,   // Level 9
    7500,   // Level 10
    // ... up to level 50
    50000,  // Level 50
  ];

  static int getLevelForXP(int xp) {
    for (int i = levelThresholds.length - 1; i >= 0; i--) {
      if (xp >= levelThresholds[i]) {
        return i + 1;
      }
    }
    return 1;
  }

  static int getXPForNextLevel(int currentLevel) {
    if (currentLevel >= levelThresholds.length) {
      return -1; // Max level
    }
    return levelThresholds[currentLevel];
  }

  static double getProgressToNextLevel(int xp) {
    final level = getLevelForXP(xp);
    if (level >= levelThresholds.length) return 1.0;

    final currentLevelXP = levelThresholds[level - 1];
    final nextLevelXP = levelThresholds[level];
    final progress = (xp - currentLevelXP) / (nextLevelXP - currentLevelXP);
    return progress.clamp(0.0, 1.0);
  }

  static LevelReward getRewardForLevel(int level) {
    return switch (level) {
      5 => LevelReward(coins: 50, badge: 'rising_star'),
      10 => LevelReward(coins: 100, superLikes: 5, badge: 'veteran'),
      20 => LevelReward(coins: 200, boost: 1, badge: 'expert'),
      30 => LevelReward(coins: 500, superLikes: 10, badge: 'master'),
      50 => LevelReward(coins: 1000, boost: 3, badge: 'legend'),
      _ => LevelReward(coins: level * 5),
    };
  }
}

class LevelReward {
  final int coins;
  final int superLikes;
  final int boost;
  final String? badge;

  const LevelReward({
    this.coins = 0,
    this.superLikes = 0,
    this.boost = 0,
    this.badge,
  });
}
            </code></pre>

            <h2>XP Award Function</h2>
            <pre><code class="language-typescript">
// functions/src/gamification/awardXP.ts

interface XPEvent {
  userId: string;
  action: XPAction;
  metadata?: Record<string, any>;
}

enum XPAction {
  DAILY_LOGIN = 'daily_login',
  SEND_MESSAGE = 'send_message',
  RECEIVE_MATCH = 'receive_match',
  COMPLETE_PROFILE = 'complete_profile',
  LIKE = 'like',
  SUPER_LIKE = 'super_like',
  COMPLETE_CHALLENGE = 'complete_challenge',
  REFER_FRIEND = 'refer_friend',
}

const XP_VALUES: Record<XPAction, number> = {
  [XPAction.DAILY_LOGIN]: 10,
  [XPAction.SEND_MESSAGE]: 5,
  [XPAction.RECEIVE_MATCH]: 25,
  [XPAction.COMPLETE_PROFILE]: 100,
  [XPAction.LIKE]: 2,
  [XPAction.SUPER_LIKE]: 5,
  [XPAction.COMPLETE_CHALLENGE]: 50,
  [XPAction.REFER_FRIEND]: 200,
};

export async function awardXP(event: XPEvent): Promise<void> {
  const { userId, action, metadata } = event;

  // Get user data
  const userRef = firestore.collection('users').doc(userId);
  const userDoc = await userRef.get();
  const user = userDoc.data()!;

  // Calculate XP with streak multiplier
  let baseXP = XP_VALUES[action];
  const multiplier = getStreakMultiplier(user.streakDays);
  const totalXP = Math.floor(baseXP * multiplier);

  // Get current and new level
  const oldXP = user.xp;
  const newXP = oldXP + totalXP;
  const oldLevel = getLevelForXP(oldXP);
  const newLevel = getLevelForXP(newXP);

  // Update user
  await userRef.update({
    xp: admin.firestore.FieldValue.increment(totalXP),
    level: newLevel,
  });

  // Record XP event
  await firestore.collection('users').doc(userId).collection('xp_history').add({
    action,
    amount: totalXP,
    multiplier,
    timestamp: admin.firestore.FieldValue.serverTimestamp(),
    metadata,
  });

  // Check for level up
  if (newLevel > oldLevel) {
    await handleLevelUp(userId, newLevel);
  }

  // Check achievements
  await checkAchievements(userId, action);
}

async function handleLevelUp(userId: string, newLevel: number): Promise<void> {
  const reward = getLevelReward(newLevel);

  // Award rewards
  const updates: any = {};
  if (reward.coins > 0) {
    updates.coins = admin.firestore.FieldValue.increment(reward.coins);
  }

  await firestore.collection('users').doc(userId).update(updates);

  // Send notification
  await sendNotification(userId, {
    type: 'level_up',
    title: `Level ${newLevel} Reached!`,
    body: `You earned ${reward.coins} coins!`,
    data: { level: newLevel, reward },
  });

  // Award badge if applicable
  if (reward.badge) {
    await awardBadge(userId, reward.badge);
  }
}

function getStreakMultiplier(streakDays: number): number {
  if (streakDays >= 100) return 3.0;
  if (streakDays >= 30) return 2.0;
  if (streakDays >= 7) return 1.5;
  return 1.0;
}
            </code></pre>

            <h2>Achievement System</h2>
            <pre><code class="language-dart">
// lib/features/gamification/domain/entities/achievement.dart

enum AchievementId {
  firstMatch,
  tenMatches,
  hundredMatches,
  firstMessage,
  chatMaster,      // 1000 messages
  superStar,       // 100 super likes received
  profileComplete,
  verified,
  weekStreak,
  monthStreak,
  centuryStreak,   // 100 day streak
  socialButterfly, // Connected all social accounts
  earlyAdopter,
}

class Achievement {
  final AchievementId id;
  final String name;
  final String description;
  final String iconAsset;
  final int coinReward;
  final int xpReward;
  final bool isSecret;

  static const achievements = {
    AchievementId.firstMatch: Achievement(
      id: AchievementId.firstMatch,
      name: 'First Spark',
      description: 'Get your first match',
      iconAsset: 'assets/badges/first_match.png',
      coinReward: 20,
      xpReward: 50,
    ),
    AchievementId.hundredMatches: Achievement(
      id: AchievementId.hundredMatches,
      name: 'Match Master',
      description: 'Get 100 matches',
      iconAsset: 'assets/badges/match_master.png',
      coinReward: 500,
      xpReward: 1000,
    ),
    AchievementId.centuryStreak: Achievement(
      id: AchievementId.centuryStreak,
      name: 'Century Club',
      description: 'Maintain a 100 day login streak',
      iconAsset: 'assets/badges/century.png',
      coinReward: 1000,
      xpReward: 2000,
      isSecret: true,
    ),
    // ... more achievements
  };
}
            </code></pre>

            <h2>Gamification Data Model</h2>
            <pre><code>
// User gamification fields
{
  "xp": 2500,
  "level": 8,
  "streakDays": 15,
  "lastStreakDate": "2024-01-15T00:00:00Z",
  "achievements": [
    "firstMatch",
    "profileComplete",
    "weekStreak"
  ],
  "badges": [
    {
      "id": "rising_star",
      "earnedAt": "2024-01-10T00:00:00Z"
    }
  ]
}

// XP History: users/{userId}/xp_history/{eventId}
{
  "action": "receive_match",
  "amount": 37,  // 25 base * 1.5 multiplier
  "multiplier": 1.5,
  "timestamp": "2024-01-15T14:30:00Z"
}
            </code></pre>
        
            </div>
        </div>
    </main>

    <script src="../js/main.js"></script>
</body>
</html>