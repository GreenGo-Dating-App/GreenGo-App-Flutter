<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caching Strategy - GreenGo Documentation</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">ğŸŒ¿</span>
                <a href="../index.html" class="logo-text" style="text-decoration: none; color: #D4AF37;">GreenGo</a>
            </div>
        </div>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search...">
        </div>
        
        
        <ul class="nav-menu" id="navMenu">
            <!-- 1. Project Overview -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="overview">
                    <i class="fas fa-home"></i>
                    <span>Project Overview</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="01-introduction.html">1. Project Introduction</a></li>
                    <li><a href="02-tech-stack.html">2. Technology Stack</a></li>
                    <li><a href="03-repository-structure.html">3. Repository Structure</a></li>
                    <li><a href="04-version-history.html">4. Version History</a></li>
                    <li><a href="05-getting-started.html">5. Getting Started</a></li>
                    <li><a href="06-dev-environment.html">6. Development Environment</a></li>
                    <li><a href="07-quick-start.html">7. Quick Start Tutorial</a></li>
                    <li><a href="08-glossary.html">8. Glossary & Terminology</a></li>
                </ul>
            </li>

            <!-- 2. Architecture -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="architecture">
                    <i class="fas fa-sitemap"></i>
                    <span>Architecture</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="09-clean-architecture.html">9. Clean Architecture</a></li>
                    <li><a href="10-feature-modules.html">10. Feature Modules</a></li>
                    <li><a href="11-state-management.html">11. State Management (BLoC)</a></li>
                    <li><a href="12-dependency-injection.html">12. Dependency Injection</a></li>
                    <li><a href="13-repository-pattern.html">13. Repository Pattern</a></li>
                    <li><a href="14-data-flow.html">14. Data Flow Diagram</a></li>
                    <li><a href="15-error-handling.html">15. Error Handling</a></li>
                    <li><a href="16-navigation.html">16. Navigation & Routing</a></li>
                    <li><a href="17-api-layer.html">17. API & Network Layer</a></li>
                    <li><a href="18-caching.html">18. Caching Strategy</a></li>
                    <li><a href="19-real-time.html">19. Real-time Communication</a></li>
                    <li><a href="20-testing-architecture.html">20. Testing Architecture</a></li>
                </ul>
            </li>

            <!-- 3. Design System -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="design">
                    <i class="fas fa-palette"></i>
                    <span>Design System</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="21-brand-guidelines.html">21. Brand Guidelines</a></li>
                    <li><a href="22-color-palette.html">22. Color Palette</a></li>
                    <li><a href="23-typography.html">23. Typography System</a></li>
                    <li><a href="24-spacing.html">24. Spacing & Dimensions</a></li>
                    <li><a href="25-components.html">25. Component Library</a></li>
                    <li><a href="26-icons.html">26. Icon System</a></li>
                    <li><a href="27-animations.html">27. Animation Guidelines</a></li>
                    <li><a href="28-theming.html">28. Dark/Light Theme</a></li>
                    <li><a href="29-responsive.html">29. Responsive Design</a></li>
                    <li><a href="30-accessibility.html">30. Accessibility Guidelines</a></li>
                </ul>
            </li>

            <!-- 4. Core Features -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="features">
                    <i class="fas fa-puzzle-piece"></i>
                    <span>Core Features</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="31-auth-flow.html">31. Authentication Flow</a></li>
                    <li><a href="32-social-auth.html">32. Social Authentication</a></li>
                    <li><a href="33-biometric-auth.html">33. Biometric Authentication</a></li>
                    <li><a href="34-onboarding.html">34. Profile Onboarding</a></li>
                    <li><a href="35-photo-upload.html">35. Photo Management</a></li>
                    <li><a href="36-profile-editing.html">36. Profile Editing</a></li>
                    <li><a href="37-matching-algorithm.html">37. Matching Algorithm</a></li>
                    <li><a href="38-discovery.html">38. Discovery Interface</a></li>
                    <li><a href="39-like-actions.html">39. Like/Pass Actions</a></li>
                    <li><a href="40-match-system.html">40. Match System</a></li>
                    <li><a href="41-chat.html">41. Real-time Chat</a></li>
                    <li><a href="42-message-features.html">42. Message Features</a></li>
                    <li><a href="43-push-notifications.html">43. Push Notifications</a></li>
                    <li><a href="44-in-app-notifications.html">44. In-App Notifications</a></li>
                    <li><a href="45-subscriptions.html">45. Subscription Tiers</a></li>
                    <li><a href="46-in-app-purchases.html">46. In-App Purchases</a></li>
                    <li><a href="47-coins.html">47. Virtual Currency</a></li>
                    <li><a href="48-gamification.html">48. Gamification System</a></li>
                    <li><a href="49-challenges.html">49. Daily Challenges</a></li>
                    <li><a href="50-leaderboards.html">50. Leaderboards</a></li>
                </ul>
            </li>

            <!-- 5. Backend Services -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="backend">
                    <i class="fas fa-server"></i>
                    <span>Backend Services</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="51-firebase-overview.html">51. Firebase Overview</a></li>
                    <li><a href="52-firestore.html">52. Firestore Database</a></li>
                    <li><a href="53-firebase-auth.html">53. Firebase Authentication</a></li>
                    <li><a href="54-firebase-storage.html">54. Firebase Storage</a></li>
                    <li><a href="55-cloud-functions.html">55. Cloud Functions</a></li>
                    <li><a href="56-django-backend.html">56. Django Backend</a></li>
                    <li><a href="57-api-documentation.html">57. API Documentation</a></li>
                    <li><a href="58-realtime-sync.html">58. Real-time Sync</a></li>
                    <li><a href="59-background-processing.html">59. Background Processing</a></li>
                    <li><a href="60-rate-limiting.html">60. Rate Limiting</a></li>
                </ul>
            </li>

            <!-- 6. Database -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="database">
                    <i class="fas fa-database"></i>
                    <span>Database</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="61-firestore-schema.html">61. Firestore Schema</a></li>
                    <li><a href="62-postgresql-schema.html">62. PostgreSQL Schema</a></li>
                    <li><a href="63-data-migration.html">63. Data Migration</a></li>
                    <li><a href="64-indexing.html">64. Indexing Strategy</a></li>
                    <li><a href="65-backup-recovery.html">65. Backup & Recovery</a></li>
                    <li><a href="66-data-retention.html">66. Data Retention Policy</a></li>
                    <li><a href="67-redis-caching.html">67. Redis Caching</a></li>
                    <li><a href="68-bigquery.html">68. BigQuery Analytics</a></li>
                </ul>
            </li>

            <!-- 7. Security -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="security">
                    <i class="fas fa-shield-alt"></i>
                    <span>Security</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="69-security-architecture.html">69. Security Architecture</a></li>
                    <li><a href="70-firestore-rules.html">70. Firestore Rules</a></li>
                    <li><a href="71-storage-rules.html">71. Storage Rules</a></li>
                    <li><a href="72-auth-security.html">72. Authentication Security</a></li>
                    <li><a href="73-encryption.html">73. Data Encryption</a></li>
                    <li><a href="74-app-check.html">74. App Check</a></li>
                    <li><a href="75-content-moderation.html">75. Content Moderation</a></li>
                    <li><a href="76-spam-detection.html">76. Spam Detection</a></li>
                    <li><a href="77-reporting-system.html">77. Reporting System</a></li>
                    <li><a href="78-security-audit.html">78. Security Audit</a></li>
                </ul>
            </li>

            <!-- 8. Third-Party Integrations -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="integrations">
                    <i class="fas fa-plug"></i>
                    <span>Integrations</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="79-agora-video.html">79. Agora Video Calling</a></li>
                    <li><a href="80-stripe.html">80. Stripe Payments</a></li>
                    <li><a href="81-sendgrid.html">81. SendGrid Email</a></li>
                    <li><a href="82-twilio.html">82. Twilio SMS</a></li>
                    <li><a href="83-google-maps.html">83. Google Maps</a></li>
                    <li><a href="84-google-cloud-ai.html">84. Google Cloud AI</a></li>
                    <li><a href="85-mixpanel.html">85. Mixpanel Analytics</a></li>
                    <li><a href="86-sentry.html">86. Sentry Tracking</a></li>
                    <li><a href="87-perspective-api.html">87. Perspective API</a></li>
                    <li><a href="88-revenuecat.html">88. RevenueCat</a></li>
                </ul>
            </li>

            <!-- 9. DevOps -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="devops">
                    <i class="fas fa-cogs"></i>
                    <span>DevOps</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="89-terraform.html">89. Terraform Infrastructure</a></li>
                    <li><a href="90-docker.html">90. Docker Development</a></li>
                    <li><a href="91-cicd.html">91. CI/CD Pipeline</a></li>
                    <li><a href="92-environments.html">92. Environment Management</a></li>
                    <li><a href="93-feature-flags.html">93. Feature Flags</a></li>
                    <li><a href="94-pre-commit.html">94. Pre-commit Hooks</a></li>
                    <li><a href="95-deployment.html">95. Deployment Scripts</a></li>
                    <li><a href="96-firebase-hosting.html">96. Firebase Hosting</a></li>
                </ul>
            </li>

            <!-- 10. Testing -->
            <li class="nav-section">
                <div class="nav-section-title" data-section="testing">
                    <i class="fas fa-vial"></i>
                    <span>Testing</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <ul class="nav-submenu">
                    <li><a href="97-unit-testing.html">97. Unit Testing</a></li>
                    <li><a href="98-widget-testing.html">98. Widget Testing</a></li>
                    <li><a href="99-integration-testing.html">99. Integration Testing</a></li>
                    <li><a href="100-firebase-test-lab.html">100. Firebase Test Lab</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        <header class="top-header">
            <button class="mobile-menu-toggle" id="mobileMenuToggle"><i class="fas fa-bars"></i></button>
            <div class="header-title"><h1>Caching Strategy</h1></div>
        </header>

        <div class="content-wrapper">
            <div class="page-header">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a> / <a href="#">Architecture</a> / Caching Strategy
                </div>
            </div>

            <div class="page-content">
                
            <h2>Caching Architecture</h2>
            <p>GreenGo implements a multi-layer caching strategy to optimize performance and enable offline functionality. The caching system uses Hive for persistent storage and in-memory caching for frequently accessed data.</p>

            <h2>Caching Layers Diagram</h2>
            <pre><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CACHING ARCHITECTURE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APPLICATION REQUEST                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     L1: MEMORY CACHE          â”‚
                    â”‚     â€¢ Instant access          â”‚
                    â”‚     â€¢ Session-scoped          â”‚
                    â”‚     â€¢ Limited size            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           Miss     â”‚     Hit
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     L2: HIVE LOCAL DB         â”‚
                    â”‚     â€¢ Persistent storage      â”‚
                    â”‚     â€¢ Encrypted data          â”‚
                    â”‚     â€¢ TTL-based expiry        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           Miss     â”‚     Hit
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     L3: FIREBASE CACHE        â”‚
                    â”‚     â€¢ Firestore offline       â”‚
                    â”‚     â€¢ Automatic sync          â”‚
                    â”‚     â€¢ Conflict resolution     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           Miss     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     NETWORK REQUEST           â”‚
                    â”‚     â€¢ Firebase/API call       â”‚
                    â”‚     â€¢ Update all cache layers â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </code></pre>

            <h2>Cache Data Flow</h2>
            <pre><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CACHE READ FLOW                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Request       Memory        Hive         Firestore      Network
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚ get(key)   â”‚             â”‚              â”‚              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚              â”‚              â”‚
     â”‚            â”‚ check       â”‚              â”‚              â”‚
     â”‚            â”‚â”€â”€â”€â”€â”        â”‚              â”‚              â”‚
     â”‚            â”‚    â”‚        â”‚              â”‚              â”‚
     â”‚            â”‚â—€â”€â”€â”€â”˜        â”‚              â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚   HIT?     â”‚             â”‚              â”‚              â”‚
     â”‚â—€â”€â”€Yesâ”€â”€â”€â”€â”€â”€â”‚             â”‚              â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚            â”‚ get(key)    â”‚              â”‚              â”‚
     â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚              â”‚
     â”‚            â”‚             â”‚ check        â”‚              â”‚
     â”‚            â”‚             â”‚â”€â”€â”€â”€â”         â”‚              â”‚
     â”‚            â”‚             â”‚    â”‚         â”‚              â”‚
     â”‚            â”‚             â”‚â—€â”€â”€â”€â”˜         â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚   HIT?     â”‚    data     â”‚              â”‚              â”‚
     â”‚â—€â”€â”€Yesâ”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚              â”‚
     â”‚            â”‚ save        â”‚              â”‚              â”‚
     â”‚            â”‚â”€â”€â”€â”€â”        â”‚              â”‚              â”‚
     â”‚            â”‚â—€â”€â”€â”€â”˜        â”‚              â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚            â”‚             â”‚ get(key)     â”‚              â”‚
     â”‚            â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚ check        â”‚
     â”‚            â”‚             â”‚              â”‚â”€â”€â”€â”€â”         â”‚
     â”‚            â”‚             â”‚              â”‚â—€â”€â”€â”€â”˜         â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚   HIT?     â”‚    data     â”‚     data     â”‚              â”‚
     â”‚â—€â”€â”€Yesâ”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚ fetch        â”‚
     â”‚            â”‚             â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚            â”‚             â”‚              â”‚     data     â”‚
     â”‚   data     â”‚    save     â”‚    save      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
     â”‚            â”‚             â”‚              â”‚              â”‚
            </code></pre>

            <h2>Cache Manager Implementation</h2>
            <p><strong>File:</strong> <code>lib/core/cache/cache_manager.dart</code></p>
            <pre><code class="language-dart">
class CacheManager {
  final HiveInterface _hive;
  final Map<String, dynamic> _memoryCache = {};
  final Map<String, DateTime> _cacheTimestamps = {};

  // Cache configuration
  static const defaultTTL = Duration(minutes: 30);
  static const maxMemoryCacheSize = 100;

  CacheManager({required HiveInterface hive}) : _hive = hive;

  // Initialize cache boxes
  Future<void> init() async {
    await _hive.openBox('userCache');
    await _hive.openBox('matchCache');
    await _hive.openBox('chatCache');
    await _hive.openBox('settingsCache');
  }

  // Get from cache with multi-layer lookup
  Future<T?> get<T>(
    String key, {
    String box = 'default',
    Duration? ttl,
  }) async {
    // L1: Check memory cache
    if (_memoryCache.containsKey(key)) {
      if (_isValid(key, ttl ?? defaultTTL)) {
        return _memoryCache[key] as T;
      } else {
        _memoryCache.remove(key);
        _cacheTimestamps.remove(key);
      }
    }

    // L2: Check Hive cache
    final hiveBox = _hive.box(box);
    final cached = hiveBox.get(key);

    if (cached != null) {
      final cacheEntry = CacheEntry.fromJson(cached);
      if (cacheEntry.isValid(ttl ?? defaultTTL)) {
        // Promote to memory cache
        _setMemoryCache(key, cacheEntry.data);
        return cacheEntry.data as T;
      } else {
        await hiveBox.delete(key);
      }
    }

    return null;
  }

  // Set cache with multi-layer write
  Future<void> set<T>(
    String key,
    T value, {
    String box = 'default',
    Duration? ttl,
  }) async {
    // L1: Set memory cache
    _setMemoryCache(key, value);

    // L2: Set Hive cache
    final hiveBox = _hive.box(box);
    final entry = CacheEntry(
      data: value,
      timestamp: DateTime.now(),
      ttl: ttl ?? defaultTTL,
    );
    await hiveBox.put(key, entry.toJson());
  }

  // Remove from all cache layers
  Future<void> remove(String key, {String box = 'default'}) async {
    _memoryCache.remove(key);
    _cacheTimestamps.remove(key);
    await _hive.box(box).delete(key);
  }

  // Clear specific cache box
  Future<void> clearBox(String box) async {
    _memoryCache.clear();
    _cacheTimestamps.clear();
    await _hive.box(box).clear();
  }

  // Clear all caches
  Future<void> clearAll() async {
    _memoryCache.clear();
    _cacheTimestamps.clear();
    for (final box in ['userCache', 'matchCache', 'chatCache', 'settingsCache']) {
      await _hive.box(box).clear();
    }
  }

  void _setMemoryCache(String key, dynamic value) {
    // Enforce size limit
    if (_memoryCache.length >= maxMemoryCacheSize) {
      final oldestKey = _cacheTimestamps.entries
          .reduce((a, b) => a.value.isBefore(b.value) ? a : b)
          .key;
      _memoryCache.remove(oldestKey);
      _cacheTimestamps.remove(oldestKey);
    }

    _memoryCache[key] = value;
    _cacheTimestamps[key] = DateTime.now();
  }

  bool _isValid(String key, Duration ttl) {
    final timestamp = _cacheTimestamps[key];
    if (timestamp == null) return false;
    return DateTime.now().difference(timestamp) < ttl;
  }
}

class CacheEntry {
  final dynamic data;
  final DateTime timestamp;
  final Duration ttl;

  CacheEntry({
    required this.data,
    required this.timestamp,
    required this.ttl,
  });

  bool isValid(Duration maxAge) {
    return DateTime.now().difference(timestamp) < maxAge;
  }

  Map<String, dynamic> toJson() => {
        'data': data,
        'timestamp': timestamp.toIso8601String(),
        'ttl': ttl.inMilliseconds,
      };

  factory CacheEntry.fromJson(Map<String, dynamic> json) => CacheEntry(
        data: json['data'],
        timestamp: DateTime.parse(json['timestamp']),
        ttl: Duration(milliseconds: json['ttl']),
      );
}
            </code></pre>

            <h2>Cache Policies by Data Type</h2>
            <table>
                <thead>
                    <tr><th>Data Type</th><th>TTL</th><th>Strategy</th><th>Box</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>User Profile</strong></td>
                        <td>1 hour</td>
                        <td>Cache-first, background refresh</td>
                        <td>userCache</td>
                    </tr>
                    <tr>
                        <td><strong>Match Cards</strong></td>
                        <td>5 minutes</td>
                        <td>Network-first with fallback</td>
                        <td>matchCache</td>
                    </tr>
                    <tr>
                        <td><strong>Chat Messages</strong></td>
                        <td>24 hours</td>
                        <td>Real-time sync with cache</td>
                        <td>chatCache</td>
                    </tr>
                    <tr>
                        <td><strong>User Settings</strong></td>
                        <td>Permanent</td>
                        <td>Local-first, sync on change</td>
                        <td>settingsCache</td>
                    </tr>
                    <tr>
                        <td><strong>Discovery Filters</strong></td>
                        <td>Session</td>
                        <td>Memory only</td>
                        <td>N/A</td>
                    </tr>
                </tbody>
            </table>

            <h2>Offline Sync Queue</h2>
            <p><strong>File:</strong> <code>lib/core/cache/sync_queue.dart</code></p>
            <pre><code class="language-dart">
class SyncQueue {
  final Box _queueBox;
  final NetworkInfo _networkInfo;

  SyncQueue({
    required Box queueBox,
    required NetworkInfo networkInfo,
  })  : _queueBox = queueBox,
        _networkInfo = networkInfo;

  // Add operation to queue
  Future<void> enqueue(SyncOperation operation) async {
    await _queueBox.add(operation.toJson());
  }

  // Process queue when online
  Future<void> processQueue() async {
    if (!await _networkInfo.isConnected) return;

    final operations = _queueBox.values
        .map((e) => SyncOperation.fromJson(e))
        .toList();

    for (int i = 0; i < operations.length; i++) {
      try {
        await _executeOperation(operations[i]);
        await _queueBox.deleteAt(i);
      } catch (e) {
        // Keep in queue for retry
        operations[i].incrementRetry();
        if (operations[i].retryCount > 3) {
          await _queueBox.deleteAt(i);
          // Log failed operation
        }
      }
    }
  }

  Future<void> _executeOperation(SyncOperation op) async {
    // Execute based on operation type
    switch (op.type) {
      case SyncOperationType.createMessage:
        // Send message to server
        break;
      case SyncOperationType.updateProfile:
        // Update profile on server
        break;
      case SyncOperationType.recordSwipe:
        // Record swipe on server
        break;
    }
  }
}
            </code></pre>
        
            </div>
        </div>
    </main>

    <script src="../js/main.js"></script>
</body>
</html>